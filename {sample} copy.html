<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Expense Balance Calculator • Everytool</title>
  <style>
    :root{
      --bg:#0f1115; --panel:#161a22; --ink:#e8ecf1; --muted:#9aa4b2;
      --accent:#3b82f6; --danger:#ef4444; --ok:#10b981; --line:#232a36;
      --radius:14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      color:var(--ink); background:linear-gradient(180deg,#0d1016, #0b0e13 40%, #0a0c11);
    }
    .wrap{
      max-width:900px; margin:auto; padding:28px 16px 60px;
    }
    .card{
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:20px;
      box-shadow:0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.02);
    }
    h1{font-size:1.35rem; margin:0 0 10px}
    p.lead{color:var(--muted); margin:0 0 18px; font-size:.95rem}

    .grid{display:grid; gap:14px}
    @media (min-width:720px){ .grid.cols-2{grid-template-columns:1fr 1fr} }

    label{display:block; font-size:.9rem; color:var(--muted); margin:0 0 6px}
    input[type="number"], input[type="text"], select{
      width:100%; background:#0f131b; color:var(--ink);
      border:1px solid var(--line); border-radius:12px; padding:12px 14px;
      outline:none;
    }
    input[type="number"]:focus, input[type="text"]:focus, select:focus{
      border-color:var(--accent); box-shadow:0 0 0 3px rgba(59,130,246,.18);
    }

    .row{
      display:grid; grid-template-columns: minmax(120px,1fr) 160px 44px;
      gap:10px; align-items:center;
    }
    @media (max-width:540px){
      .row{grid-template-columns:1fr 1fr 44px}
    }

    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:.5ch;
      padding:10px 14px; border-radius:12px; border:1px solid var(--line);
      background:#0f131b; color:var(--ink); cursor:pointer; text-decoration:none;
      user-select:none;
    }
    .btn:hover{border-color:#2a3344}
    .btn.primary{background:var(--accent); border-color:transparent}
    .btn.ghost{background:transparent}

    .table{display:grid; gap:10px; margin-top:10px}
    .muted{color:var(--muted)}
    .controls{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}

    .summary{
      margin-top:18px; padding:16px; border-radius:12px; border:1px dashed var(--line);
      background:#0e131b;
      display:grid; gap:8px;
    }
    .summary b{font-size:1.05rem}
    .badge{
      padding:.25rem .55rem; border-radius:999px; font-size:.8rem; border:1px solid var(--line);
    }
    .badge.ok{background:#0b1713; color:#b7f3dd; border-color:#123b2f}
    .badge.warn{background:#1b0c0c; color:#ffc9c9; border-color:#472223}

    .danger{color:var(--danger)}
    .sr-only{position:absolute!important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    footer{margin-top:28px; color:var(--muted); font-size:.85rem; text-align:center}
  </style>
</head>
<body>
  <main class="wrap">
    <div class="card" role="region" aria-labelledby="title">
      <h1 id="title">Expense Balance Calculator</h1>
      <p class="lead">Enter your total budget and add expenses below. The remaining amount updates automatically as you type.</p>

      <div class="grid cols-2">
        <div>
          <label for="currency">Currency</label>
          <select id="currency" aria-label="Currency">
            <option value="INR" selected>INR (₹)</option>
            <option value="USD">USD ($)</option>
            <option value="EUR">EUR (€)</option>
            <option value="GBP">GBP (£)</option>
          </select>
        </div>
        <div>
          <label for="totalAmount">Total Amount</label>
          <input id="totalAmount" type="number" inputmode="decimal" min="0" step="0.01" placeholder="e.g., 5000" />
        </div>
      </div>

      <div class="controls" aria-label="Expense actions">
        <button class="btn primary" id="addRowBtn" type="button">＋ Add expense</button>
        <button class="btn ghost" id="resetBtn" type="button" title="Clear all expenses">Reset</button>
      </div>

      <div class="table" id="expenseList" aria-live="polite" aria-relevant="additions removals">
        <!-- Expense rows will appear here -->
      </div>

      <div class="summary" aria-live="polite" aria-atomic="true">
        <div><span class="muted">Total expenses:</span> <b id="totalExpenses">₹0.00</b></div>
        <div>
          <span class="muted">Remaining:</span>
          <b id="remaining" class="badge ok">₹0.00</b>
        </div>
        <div id="overshootMsg" class="muted" style="display:none">
          <span class="danger">You’ve exceeded your total amount.</span>
        </div>
      </div>

      <div class="card" style="margin-top:16px" role="region" aria-label="Expense distribution chart">
        <canvas id="expenseChart" width="400" height="260" aria-label="Expenses chart" role="img"></canvas>
      </div>
    </div>

    <footer>Tip: You can keep adding rows and edit amounts anytime — the remaining balance updates instantly.</footer>
  </main>

  <template id="expenseRowTpl">
    <div class="row expense-row">
      <div>
        <label class="sr-only">Amount</label>
        <input type="number" class="expense-amount" inputmode="decimal" min="0" step="0.01" placeholder="0.00" />
      </div>
      <div>
        <label class="sr-only">Expense name</label>
        <input type="text" class="expense-name" placeholder="e.g., Groceries" />
      </div>
      <div>
        <button class="btn ghost remove-btn" type="button" title="Remove this expense">✕</button>
      </div>
    </div>
  </template>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" integrity="sha384-YnK0JwVw6Qx4z5Hq5xC+oZp2yJrVQk4rI3v3F18vUoYJ7V7b0HqZbJqQmA3r1JmH" crossorigin="anonymous"></script>

  <script>
    (function(){
      const currencyEl = document.getElementById('currency');
      const totalEl = document.getElementById('totalAmount');
      const listEl = document.getElementById('expenseList');
      const addBtn = document.getElementById('addRowBtn');
      const resetBtn = document.getElementById('resetBtn');

      const totalExpensesEl = document.getElementById('totalExpenses');
      const remainingEl = document.getElementById('remaining');
      const overshootMsg = document.getElementById('overshootMsg');
      const rowTpl = document.getElementById('expenseRowTpl');
      const chartCanvas = document.getElementById('expenseChart');
      let chart;

      function nf(){
        return new Intl.NumberFormat(undefined, {
          style:'currency', currency: currencyEl.value, maximumFractionDigits: 2
        });
      }

      function parseNum(v){
        const n = parseFloat(v);
        return isNaN(n) ? 0 : n;
      }

      function calc(){
        const total = parseNum(totalEl.value);
        const names = [...listEl.querySelectorAll('.expense-name')].map(i => i.value.trim() || '—');
        const amounts = [...listEl.querySelectorAll('.expense-amount')].map(i => parseNum(i.value));
        const expTotal = amounts.reduce((a,b)=>a+b, 0);
        const remain = total - expTotal;

        totalExpensesEl.textContent = nf().format(expTotal);
        remainingEl.textContent = nf().format(remain);

        if (remain < 0){
          remainingEl.classList.remove('ok'); remainingEl.classList.add('warn');
          overshootMsg.style.display = '';
        } else {
          remainingEl.classList.add('ok'); remainingEl.classList.remove('warn');
          overshootMsg.style.display = 'none';
        }

        updateChart(names, amounts);
      }

      function addRow(name='', amount=''){
        const node = rowTpl.content.cloneNode(true);
        const row = node.querySelector('.expense-row');
        const nameInput = row.querySelector('.expense-name');
        const amountInput = row.querySelector('.expense-amount');

        nameInput.value = name;
        amountInput.value = amount;

        listEl.appendChild(node);
        calc();
      }

      // Event listeners
      addBtn.addEventListener('click', () => addRow());
      resetBtn.addEventListener('click', () => {
        listEl.innerHTML = '';
        totalEl.value = '';
        calc();
      });

      currencyEl.addEventListener('change', calc);
      totalEl.addEventListener('input', calc);

      // Delegate row events
      listEl.addEventListener('input', (e) => {
        if (e.target.classList.contains('expense-amount') || e.target.classList.contains('expense-name')) {
          calc();
        }
      });
      listEl.addEventListener('click', (e) => {
        if (e.target.closest('.remove-btn')){
          const row = e.target.closest('.expense-row');
          row?.remove();
          calc();
        }
      });

      // Keyboard shortcut: Ctrl+X to add a new expense row
      document.addEventListener('keydown', (e) => {
        const isCtrlOrMeta = e.ctrlKey || e.metaKey;
        if (isCtrlOrMeta && (e.key === 'x' || e.key === 'X')) {
          e.preventDefault();
          addRow();
          // Focus the name field of the newly added row
          const lastRow = listEl.querySelector('.expense-row:last-of-type');
          lastRow?.querySelector('.expense-name')?.focus();
        }
      });

      // Start with one blank row
      addRow();

      function updateChart(labels, data){
        if (!chartCanvas || typeof Chart === 'undefined') return;

        const colors = labels.map((_, idx) => {
          const palette = [
            '#3b82f6','#10b981','#f59e0b','#ef4444','#8b5cf6',
            '#06b6d4','#84cc16','#eab308','#ec4899','#22c55e'
          ];
          return palette[idx % palette.length];
        });

        const ds = [{
          data,
          backgroundColor: colors,
          borderColor: '#1f2937',
          borderWidth: 1
        }];

        if (!chart){
          chart = new Chart(chartCanvas, {
            type: 'doughnut',
            data: { labels, datasets: ds },
            options: {
              responsive: true,
              plugins: {
                legend: { labels: { color: '#e8ecf1' } },
                tooltip: {
                  callbacks: {
                    label: (ctx) => {
                      const val = ctx.parsed;
                      try { return `${ctx.label}: ${nf().format(val)}` } catch(_) { return `${ctx.label}: ${val}` }
                    }
                  }
                }
              }
            }
          });
        } else {
          chart.data.labels = labels;
          chart.data.datasets = ds;
          chart.update();
        }
      }
    })();
  </script>
</body>
</html>
